#!/bin/sh

set -euo pipefail

KYSELY_VERSION=${KYSELY_VERSION:-0.27.3}
echo "Testing with Kysely version $KYSELY_VERSION"

KYSELY_VERSION=${KYSELY_VERSION//./}
sed -i '' 's|await import(.*)|await import(\"kysely-'$KYSELY_VERSION'\")|g' tests/setup/kysely.ts
vitest unit src --run
sed -i '' 's|await import(.*)|await import(\"kysely\")|g' tests/setup/kysely.ts
